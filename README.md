# Drafts Action for Tana's V2 API 
https://tana.inc/docs/input-api

The Tana Input API v2 adds functionality for saving more types of data and for specifying where data should be saved to.

Relevant to this Drafts Action, clients can specify where in the Tana Workspace a new node should be placed, as well as specify a hierarchy of content nodes.
## Actions
### Add to Tana Node
When run, the user is presented with a Prompt allowing them to select the node they wish to export the draft into; this node will be the parent of their new node.

If the user cancels the Prompt, the action will exit; if the user proceeds but does not select a node, the action will fall back to using their configured default node. If they don't have one configured (PEBKAC) it will use the INBOX.
### Add to Tana
When run, the action will perform as above but without the logic of selecting from a list of parent nodes.
## Saving
Given the API's support for exporting into a node hierarchy, this action permits the user to configure this. 

The supported save modes allow the draft being exported to be saved as one node (title + body), a parent and one child (title and body), or a parent and many children (title and parsed body). It is easy to add more save modes, given access to a robust Markdown parser in the action (which it does not have).

For the modes that result in using the draft's title alone, this action uses the [displayTitle attribute](https://scripting.getdrafts.com/classes/Draft#displayTitle).
## Configuring
This Action reuses a feature of the Obsidian action group, which uses Drafts Template Tags for configuring the action. This action uses Mustache template tags, because they support inline comments which allow these configurations to be documented. 
### Template Tags:
#### [[tanaDestinationNodes]]
A markdown list of nodes, with each list item containing comma-separated (identifier, nodeID) pairs. 
These will be used to drive a Prompt to select the destination node during action execution.
ex: 
```markdown
		- My favorite node, ghu1LlEXIN1u
		- My other favorite, ghu1LlEXIN22
```
The identifier can be any string the user wants to see in the selection prompt.

At runtime, the selection is optional, and opting to not select a node will send the content to whatever the user has configured as their default.

In order to acquire these IDs, a user needs to use the Tana app and inspect the nodes they want to use. The [Tana API docs](https://tana.inc/docs/input-api) go over this in detail.
#### [[tanaDefaultNode]]
The default node to send to, such as INBOX or any Tana node.
ex:
```markdown
INBOX
```
#### [[tanaSaveMode]]
The user can opt to send the whole draft as a single node, or have it parsed into a parent node with children. 
The options are:
- `single`
    - the whole draft as a single node
- `child` 
    - the first line as a parent node, and the rest as a child node
- `children` 
    - the first line as a parent node, and the rest of the draft split by newlines as child nodes
## The Future
Given the Tana Input API v2 supports the use or creation of supertags and fields (which are just nodes, in Tana), a future iteration of this action could apply Drafts tags or other metadata to exported content. Unfortunately a user needs to use the Tana app to get the IDs for all of these nodes, which makes this annoying from an operational perspective.
## The Input API
The payloads generated by this action are in the form of:
```json
{
    targetNodeId: the selected destinationNode or default,
    nodes: [
        {
            name: draft.displayTitle or draft.content,
            children: [
                {
                    name: ...
                }
            ]
        }
    ]
}
```
There are some good resources out there for anyone interested:
- [A Ruby gem Tana API client](https://alchemists.io/projects/tana)
- [API samples (and a nice wrapper client) from Tana.inc](https://github.com/tanainc/tana-input-api-samples/tree/main)
- [Tana Community Resource Hub (requires Tana app)](https://tana.pub/yOTwTH6wVoyE/tana-community-resource-hub)
- [The Drafts issue that propted this work](https://forums.getdrafts.com/t/add-to-tana-runs-but-doesnt-add-to-tana/14907/12)